<script>
	import Browser from "./Browser.svelte"
	import MusicController from "./MusicController.svelte";

	let viewID = ""

	let playAudio	
</script>
<div id="container">
<div id="context-menu" class="invisible">
	<button type="button"
		on:mouseup={() => {
		fetch(`/api/v1/${this.parentElement.getAttribute('data-item-type')}/${this.parentElement.getAttribute('data-id')}`, {
			method: 'DELETE'
		}
		).then(() => {viewID = viewID})
		}}>
		<img src="/web/images/garbage-can.svg" alt=""/>
		<span>Delete</span>
	</button>
	<button type="button"
		on:mouseup={
			fetch(
				`/api/v1/audio/${this.parentElement.getAttribute('data-id')}?query=Cover`,
				{method: 'DELETE'}
			).then(() => viewID = viewID)
		}>
		<img src="/web/images/garbage-can.svg" alt=""/>
		<span>Delete Cover</span>
	</button>
	<button type="button"
		on:mouseup={
		fetch('/api/v1/audio/' + this.parentElement.getAttribute('data-id'), {
			method : 'PATCH',
			headers : {
				'Content-Type' : 'application/json'
			},
			body : JSON.stringify({Title:''})
		}).then(() => viewID = viewID)}
	>
		<img src="/web/images/garbage-can.svg" alt=""/>
		<span>Delete Title</span>
	</button>
	<button type="button"
		on:mouseup={
		fetch('/api/v1/audio/' + this.parentElement.getAttribute('data-id'), {
			method : 'PATCH',
			headers : {
				'Content-Type' : 'application/json'
			},
			body : JSON.stringify({Singer:''})
		}).then(() => viewID = viewID)}>
		<img src="/web/images/garbage-can.svg" alt=""/>
		<span>Delete Singer</span>
	</button>
	<button type="button">
		<img src="/web/images/pen.svg" alt=""/>
		<span>Edit</span>
	</button>
</div>
<!-- #region upload modal -->
<!-- svelte-ignore a11y-click-events-have-key-events -->
<div id="upload-background" class="invisible"
	on:click={event => {if (event.target == this) { this.classList.toggle('invisible', true)}}}
>
<!-- #region upload form -->
<form id="upload-page" action="/api/v1/audio" class="page page-audio-upload" method="POST"
	enctype="multipart/form-data"
	on:submit={() => {
		fetch('/api/v1/audio/', { method: 'POST', body: new FormData(this) }).then(() => {
			viewID = viewID
			this.reset()
			// uploadPage()
		})
		return false
		}
	}
	>
	<div id="upload-file-section"
		on:drop={() => {fileDropForUpload(event, this); this.classList.toggle('active-drop', false)}}
		on:dragenter={this.classList.toggle('active-drop', true)}
		on:dragleave={this.classList.toggle('active-drop', false)}
		on:dragover|preventDefault>
		<span
		on:drop={() => {fileDropForUpload(event, this.parentElement); this.parentElement.classList.add('active-drop')}}
		on:dragenter={this.parentElement.classList.add('active-drop')}
		on:dragover|preventDefault
		>Drag and Drop</span>
			<button type="button" class="submit" on:click={document.getElementById('upload-audio-file-input').click()}
				style="width: 8rem; margin-bottom: auto; box-shadow: 0 0.25rem 0.75rem 0 var(--gray);"
			>Select File</button>
			<!-- hidden -->
			<input id="upload-audio-file-input" type="file" name="audio" style="display: none;" required
				on:change={fillUploadForm(this.files[0])}
				accept=".mp3, .mpeg, .opus, .ogg, .oga, .wav, .aac, .caf, .m4a, .mp4, .weba, .webm, .dolby, .flac"
			/>
	</div>
	<button id="upload-next" type="button" class="submit no-border no-max-width">
		Next
	</button>

	<!-- 2nd page -->
	<div id="sound-info" class="invisible">
		<input type="file" id="upload-picture" name="cover" class="invisible"
			on:change={uploadPictureGraphic.src = toDataURI(uploadPicture.files[0])}/>
		<!-- svelte-ignore a11y-click-events-have-key-events -->
		<img src="/web/images/music.svg" id="upload-picture-graphic" alt="Audio cover"
			on:click={uploadPicture.click()} style="cursor: pointer;"
		/>
		<img src="/web/images/change-cover-overlay.svg" id="upload-picture-graphic-overlay" alt=""/>
		<div>
			<input type="text" id="upload-title" name="Title" maxlength="50" placeholder="Title" class="no-max-width"/>
			<input type="text" id="upload-singer" name="Singer" maxlength="50" placeholder="Singer"class="no-max-width"/>
			<input type="text" id="upload-format" name="Format" maxlength="50" placeholder="Format" class="no-max-width"/>
		</div>
	</div>
	<!-- close/next -->
	<button id="submit-upload" type="submit" class="no-max-width invisible">
		Submit
	</button>
</form>
<div class="page page-audio-edit">

</div>
<!-- #endregion -->
</div>
<!-- #endregion -->
<div id="quick-access">
	<button type="button" id="quick-access-profile" class="black no-shadow" on:click={location.href = '/login'}>
		<div>
			<span></span>
		</div>
		<span></span>
	</button>
	<button type="button" id="quick-access-upload" title="upload"
		class="black no-shadow" on:click={page('audio-upload')}>
		<img src="./images/upload.svg" alt="">
		<span>Upload</span>
	</button>
</div>
<Browser viewID={viewID} {playAudio}/>
<MusicController bind:playAudio/>
</div>